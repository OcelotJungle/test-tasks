# Тестовое задание про API отеля.

### Бэкенд: Node.js + Express + Typescript
### СУБД: PostgreSQL

---

Дампы для БД:
- schema.sql - схема
- mock-data.sql - тестовые данные

Как загрузить схему:
1. Создать базу данных.
2. `psql -d %название_базы% -f schema.sql`.

Как загрузить тестовые данные:
1. Загрузить схему.
2. `psql -d %название_базы% -f mock-data.sql`.

---

Как развернуть приложение для проверки:

Единократно перед первым запуском нужно загрузить все модули и собрать исходники:
```
npm i && tsc
```

Задать переменные среды (environmental variables), либо на уровне ОС, либо прописать их в файле `.env`:
```
PGUSER=имя пользователя
PGPASSWORD=пароль
PGHOST=хост
PGPORT=порт
PGDATABASE=база данных

PORT=порт, который слушает сервер
```

- Если переменные заданы на уровне ОС, то запускать командой `node ./dist/server.js`.
- Если переменные прописаны в файле, то запускать командой `NODE_ENV=production node ./dist/server.js`.

Как проверить функционал:
1. `/room` - возвращает массив всех номеров. Нормальный статус: 200.
2. `/room/free?from=2022-12-02&to=2022-12-04` - возвращает массив комнат, свободных в указанный период (from и to). Нормальный статус: 200.
    1. если задать начальную дату раньше текущей, вернёт 400
    2. если задать начальную дату позже конечной, вернёт 400
3. `/room/:roomId?from=2022-12-02&to=2022-12-04&guestId=1&vip=1` - бронирует комнату на указанный период (from и to), с указанным id гостя (guestId), id комнаты (roomId); vip=1 форсирует статус ВИП-гостя, иначе формально выполняется запрос к другому серверу, а фактически ВИП-статус задаётся с вероятностью 20% на основе ГПСЧ. Нормальный статус: 201.
    1. если задать начальную дату раньше текущей, вернёт 400
    2. если задать начальную дату позже конечной, вернёт 400
    3. если roomId или guestId не являются целыми числами или не указаны, вернёт 400
    4. если гостя с таким id нет в базе, вернёт 404
    5. если комната уже забронирована на срок, пересекающийся с указанным, вернёт 409
4. `booking/:bookingId` - удаляет бронь с указанным id. Нормальный статус: 200.
    1. если id брони не является целым числом или не указан, вернёт 406
    2. если бронь с таким id не существует, вернёт 404

Все запросы возвращают 500, если в процессе произошла ошибка связи с БД.